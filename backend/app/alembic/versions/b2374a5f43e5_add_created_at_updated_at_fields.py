"""add_created_at_updated_at_fields

Revision ID: b2374a5f43e5
Revises: db8bf70fc16a
Create Date: 2025-11-19 15:03:22.029859

"""
from alembic import op
import sqlalchemy as sa
import sqlmodel.sql.sqltypes
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'b2374a5f43e5'
down_revision = 'db8bf70fc16a'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('image', 'file_size',
               existing_type=sa.BIGINT(),
               type_=sa.Integer(),
               existing_nullable=False)
    op.alter_column('image', 'processing_status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               existing_server_default=sa.text("'pending'::character varying"))
    op.alter_column('image', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               type_=sa.DateTime(),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('image', 'updated_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               type_=sa.DateTime(),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index('ix_image_filename', table_name='image')
    op.drop_index('ix_image_owner_id', table_name='image')
    op.drop_index('ix_image_processing_status', table_name='image')
    op.alter_column('imageprocessingjob', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=False,
               existing_server_default=sa.text("'pending'::character varying"))
    op.alter_column('imageprocessingjob', 'retry_count',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('0'))
    op.drop_index('ix_imageprocessingjob_image_id', table_name='imageprocessingjob')
    op.drop_index('ix_imageprocessingjob_status', table_name='imageprocessingjob')
    op.alter_column('imagevariant', 'file_size',
               existing_type=sa.BIGINT(),
               type_=sa.Integer(),
               existing_nullable=False)
    op.alter_column('imagevariant', 'quality',
               existing_type=sa.INTEGER(),
               nullable=False,
               existing_server_default=sa.text('85'))
    op.alter_column('imagevariant', 'format',
               existing_type=sa.VARCHAR(length=10),
               nullable=False,
               existing_server_default=sa.text("'jpeg'::character varying"))
    op.alter_column('imagevariant', 'created_at',
               existing_type=postgresql.TIMESTAMP(timezone=True),
               type_=sa.DateTime(),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.drop_index('ix_imagevariant_image_id', table_name='imagevariant')
    op.drop_index('ix_imagevariant_variant_type', table_name='imagevariant')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index('ix_imagevariant_variant_type', 'imagevariant', ['variant_type'], unique=False)
    op.create_index('ix_imagevariant_image_id', 'imagevariant', ['image_id'], unique=False)
    op.alter_column('imagevariant', 'created_at',
               existing_type=sa.DateTime(),
               type_=postgresql.TIMESTAMP(timezone=True),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('imagevariant', 'format',
               existing_type=sa.VARCHAR(length=10),
               nullable=True,
               existing_server_default=sa.text("'jpeg'::character varying"))
    op.alter_column('imagevariant', 'quality',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('85'))
    op.alter_column('imagevariant', 'file_size',
               existing_type=sa.Integer(),
               type_=sa.BIGINT(),
               existing_nullable=False)
    op.create_index('ix_imageprocessingjob_status', 'imageprocessingjob', ['status'], unique=False)
    op.create_index('ix_imageprocessingjob_image_id', 'imageprocessingjob', ['image_id'], unique=False)
    op.alter_column('imageprocessingjob', 'retry_count',
               existing_type=sa.INTEGER(),
               nullable=True,
               existing_server_default=sa.text('0'))
    op.alter_column('imageprocessingjob', 'status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               existing_server_default=sa.text("'pending'::character varying"))
    op.create_index('ix_image_processing_status', 'image', ['processing_status'], unique=False)
    op.create_index('ix_image_owner_id', 'image', ['owner_id'], unique=False)
    op.create_index('ix_image_filename', 'image', ['filename'], unique=False)
    op.alter_column('image', 'updated_at',
               existing_type=sa.DateTime(),
               type_=postgresql.TIMESTAMP(timezone=True),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('image', 'created_at',
               existing_type=sa.DateTime(),
               type_=postgresql.TIMESTAMP(timezone=True),
               existing_nullable=True,
               existing_server_default=sa.text('now()'))
    op.alter_column('image', 'processing_status',
               existing_type=sa.VARCHAR(length=20),
               nullable=True,
               existing_server_default=sa.text("'pending'::character varying"))
    op.alter_column('image', 'file_size',
               existing_type=sa.Integer(),
               type_=sa.BIGINT(),
               existing_nullable=False)
    # ### end Alembic commands ###
