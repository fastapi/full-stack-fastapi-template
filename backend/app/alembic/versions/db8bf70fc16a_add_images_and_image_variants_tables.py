"""Add images and image variants tables

Revision ID: db8bf70fc16a
Revises: 1a31ce608336
Create Date: 2025-11-19 03:59:49.501431

"""
from alembic import op
import sqlalchemy as sa
import sqlmodel.sql.sqltypes


# revision identifiers, used by Alembic.
revision = 'db8bf70fc16a'
down_revision = '1a31ce608336'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('image',
    sa.Column('filename', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('original_filename', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('content_type', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.Column('file_size', sa.BigInteger(), nullable=False),
    sa.Column('width', sa.Integer(), nullable=True),
    sa.Column('height', sa.Integer(), nullable=True),
    sa.Column('s3_bucket', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('s3_key', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=False),
    sa.Column('s3_url', sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=False),
    sa.Column('processing_status', sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True, server_default='pending'),
    sa.Column('alt_text', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('description', sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True),
    sa.Column('tags', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('owner_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['owner_id'], ['user.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_image_filename'), 'image', ['filename'], unique=False)
    op.create_index(op.f('ix_image_owner_id'), 'image', ['owner_id'], unique=False)
    op.create_index(op.f('ix_image_processing_status'), 'image', ['processing_status'], unique=False)

    op.create_table('imagevariant',
    sa.Column('variant_type', sqlmodel.sql.sqltypes.AutoString(length=20), nullable=False),
    sa.Column('width', sa.Integer(), nullable=True),
    sa.Column('height', sa.Integer(), nullable=True),
    sa.Column('file_size', sa.BigInteger(), nullable=False),
    sa.Column('s3_bucket', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('s3_key', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=False),
    sa.Column('s3_url', sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=False),
    sa.Column('quality', sa.Integer(), nullable=True, server_default='85'),
    sa.Column('format', sqlmodel.sql.sqltypes.AutoString(length=10), nullable=True, server_default='jpeg'),
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('image_id', sa.UUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['image_id'], ['image.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_imagevariant_image_id'), 'imagevariant', ['image_id'], unique=False)
    op.create_index(op.f('ix_imagevariant_variant_type'), 'imagevariant', ['variant_type'], unique=False)

    op.create_table('imageprocessingjob',
    sa.Column('status', sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True, server_default='pending'),
    sa.Column('error_message', sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True),
    sa.Column('retry_count', sa.Integer(), nullable=True, server_default='0'),
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('image_id', sa.UUID(), nullable=False),
    sa.ForeignKeyConstraint(['image_id'], ['image.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_imageprocessingjob_image_id'), 'imageprocessingjob', ['image_id'], unique=False)
    op.create_index(op.f('ix_imageprocessingjob_status'), 'imageprocessingjob', ['status'], unique=False)
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_imageprocessingjob_status'), table_name='imageprocessingjob')
    op.drop_index(op.f('ix_imageprocessingjob_image_id'), table_name='imageprocessingjob')
    op.drop_table('imageprocessingjob')
    op.drop_index(op.f('ix_imagevariant_variant_type'), table_name='imagevariant')
    op.drop_index(op.f('ix_imagevariant_image_id'), table_name='imagevariant')
    op.drop_table('imagevariant')
    op.drop_index(op.f('ix_image_processing_status'), table_name='image')
    op.drop_index(op.f('ix_image_owner_id'), table_name='image')
    op.drop_index(op.f('ix_image_filename'), table_name='image')
    op.drop_table('image')
    # ### end Alembic commands ###
